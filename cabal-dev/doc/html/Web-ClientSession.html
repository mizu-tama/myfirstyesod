<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Web.ClientSession</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();setSynopsis("mini_Web-ClientSession.html");};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">clientsession-0.8.0.1: Securely store session data in a client-side cookie.</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Portability</th><td>portable</td></tr><tr><th>Stability</th><td>Stable</td></tr><tr><th>Maintainer</th><td>Michael Snoyman &lt;michael@snoyman.com&gt;</td></tr><tr><th>Safe Haskell</th><td>None</td></tr></table><p class="caption">Web.ClientSession</p></div><div id="table-of-contents"><p class="caption">Contents</p><ul><li><a href="#g:1">Automatic key generation
</a></li><li><a href="#g:2">Actual encryption/decryption
</a></li></ul></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Stores session data in a client cookie.  In order to do so,
 we:
</p><ul><li> Encrypt the cookie data using AES in CTR mode.  This allows
 you to store sensitive information on the client side without
 worrying about eavesdropping.
</li><li> Authenticate the encrypted cookie data using
 Skein-MAC-512-256.  Besides detecting potential errors in
 storage or transmission of the cookies (integrity), the MAC
 also avoids malicious modifications of the cookie data by
 assuring you that the cookie data really was generated by this
 server (authenticity).
</li><li> Encode everything using Base64.  Thus we avoid problems with
 non-printable characters by giving the browser a simple
 string.
</li></ul><p>Simple usage of the library involves just calling
 <code><a href="Web-ClientSession.html#v:getDefaultKey">getDefaultKey</a></code> on the startup of your server, <code><a href="Web-ClientSession.html#v:encryptIO">encryptIO</a></code>
 when serializing cookies and <code><a href="Web-ClientSession.html#v:decrypt">decrypt</a></code> when parsing then back.
</p></div></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><span class="keyword">data</span>  <a href="#t:Key">Key</a> </li><li class="src short"><span class="keyword">type</span> <a href="#t:IV">IV</a> = <a href="/Users/mizu_tama/workspace/yesodprojects/myfirstyesod/cabal-dev//doc/html/Crypto-Modes.html#t:IV">IV</a> <a href="/Users/mizu_tama/workspace/yesodprojects/myfirstyesod/cabal-dev//doc/html/Crypto-Cipher-AES-Haskell.html#t:AES256">AES256</a></li><li class="src short"><a href="#v:randomIV">randomIV</a> :: <a href="/Library/Frameworks/GHC.framework/Versions/7.4.2-i386/usr/share/doc/ghc/html/libraries/base-4.5.1.0/System-IO.html#t:IO">IO</a> <a href="Web-ClientSession.html#t:IV">IV</a></li><li class="src short"><a href="#v:mkIV">mkIV</a> :: <a href="/Library/Frameworks/GHC.framework/Versions/7.4.2-i386/usr/share/doc/ghc/html/libraries/bytestring-0.9.2.1/Data-ByteString.html#t:ByteString">ByteString</a> -&gt; <a href="/Library/Frameworks/GHC.framework/Versions/7.4.2-i386/usr/share/doc/ghc/html/libraries/base-4.5.1.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="Web-ClientSession.html#t:IV">IV</a></li><li class="src short"><a href="#v:getKey">getKey</a> :: <a href="/Library/Frameworks/GHC.framework/Versions/7.4.2-i386/usr/share/doc/ghc/html/libraries/base-4.5.1.0/System-IO.html#t:FilePath">FilePath</a> -&gt; <a href="/Library/Frameworks/GHC.framework/Versions/7.4.2-i386/usr/share/doc/ghc/html/libraries/base-4.5.1.0/System-IO.html#t:IO">IO</a> <a href="Web-ClientSession.html#t:Key">Key</a></li><li class="src short"><a href="#v:defaultKeyFile">defaultKeyFile</a> :: <a href="/Library/Frameworks/GHC.framework/Versions/7.4.2-i386/usr/share/doc/ghc/html/libraries/base-4.5.1.0/System-IO.html#t:FilePath">FilePath</a></li><li class="src short"><a href="#v:getDefaultKey">getDefaultKey</a> :: <a href="/Library/Frameworks/GHC.framework/Versions/7.4.2-i386/usr/share/doc/ghc/html/libraries/base-4.5.1.0/System-IO.html#t:IO">IO</a> <a href="Web-ClientSession.html#t:Key">Key</a></li><li class="src short"><a href="#v:initKey">initKey</a> :: <a href="/Library/Frameworks/GHC.framework/Versions/7.4.2-i386/usr/share/doc/ghc/html/libraries/bytestring-0.9.2.1/Data-ByteString.html#t:ByteString">ByteString</a> -&gt; <a href="/Library/Frameworks/GHC.framework/Versions/7.4.2-i386/usr/share/doc/ghc/html/libraries/base-4.5.1.0/Data-Either.html#t:Either">Either</a> <a href="/Library/Frameworks/GHC.framework/Versions/7.4.2-i386/usr/share/doc/ghc/html/libraries/base-4.5.1.0/Data-String.html#t:String">String</a> <a href="Web-ClientSession.html#t:Key">Key</a></li><li class="src short"><a href="#v:randomKey">randomKey</a> :: <a href="/Library/Frameworks/GHC.framework/Versions/7.4.2-i386/usr/share/doc/ghc/html/libraries/base-4.5.1.0/System-IO.html#t:IO">IO</a> (<a href="/Library/Frameworks/GHC.framework/Versions/7.4.2-i386/usr/share/doc/ghc/html/libraries/bytestring-0.9.2.1/Data-ByteString.html#t:ByteString">ByteString</a>, <a href="Web-ClientSession.html#t:Key">Key</a>)</li><li class="src short"><a href="#v:encrypt">encrypt</a> :: <a href="Web-ClientSession.html#t:Key">Key</a> -&gt; <a href="Web-ClientSession.html#t:IV">IV</a> -&gt; <a href="/Library/Frameworks/GHC.framework/Versions/7.4.2-i386/usr/share/doc/ghc/html/libraries/bytestring-0.9.2.1/Data-ByteString.html#t:ByteString">ByteString</a> -&gt; <a href="/Library/Frameworks/GHC.framework/Versions/7.4.2-i386/usr/share/doc/ghc/html/libraries/bytestring-0.9.2.1/Data-ByteString.html#t:ByteString">ByteString</a></li><li class="src short"><a href="#v:encryptIO">encryptIO</a> :: <a href="Web-ClientSession.html#t:Key">Key</a> -&gt; <a href="/Library/Frameworks/GHC.framework/Versions/7.4.2-i386/usr/share/doc/ghc/html/libraries/bytestring-0.9.2.1/Data-ByteString.html#t:ByteString">ByteString</a> -&gt; <a href="/Library/Frameworks/GHC.framework/Versions/7.4.2-i386/usr/share/doc/ghc/html/libraries/base-4.5.1.0/System-IO.html#t:IO">IO</a> <a href="/Library/Frameworks/GHC.framework/Versions/7.4.2-i386/usr/share/doc/ghc/html/libraries/bytestring-0.9.2.1/Data-ByteString.html#t:ByteString">ByteString</a></li><li class="src short"><a href="#v:decrypt">decrypt</a> :: <a href="Web-ClientSession.html#t:Key">Key</a> -&gt; <a href="/Library/Frameworks/GHC.framework/Versions/7.4.2-i386/usr/share/doc/ghc/html/libraries/bytestring-0.9.2.1/Data-ByteString.html#t:ByteString">ByteString</a> -&gt; <a href="/Library/Frameworks/GHC.framework/Versions/7.4.2-i386/usr/share/doc/ghc/html/libraries/base-4.5.1.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="/Library/Frameworks/GHC.framework/Versions/7.4.2-i386/usr/share/doc/ghc/html/libraries/bytestring-0.9.2.1/Data-ByteString.html#t:ByteString">ByteString</a></li></ul></div><div id="interface"><h1 id="g:1">Automatic key generation
</h1><div class="top"><p class="src"><span class="keyword">data</span>  <a name="t:Key" class="def">Key</a>  </p><div class="doc"><p>The keys used to store the cookies.  We have an AES key used
 to encrypt the cookie and a Skein-MAC-512-256 key used verify
 the authencity and integrity of the cookie.  The AES key needs
 to have exactly 32 bytes (256 bits) while Skein-MAC-512-256
 should have 64 bytes (512 bits).
</p><p>See also <code><a href="Web-ClientSession.html#v:getDefaultKey">getDefaultKey</a></code> and <code><a href="Web-ClientSession.html#v:initKey">initKey</a></code>.
</p></div><div class="subs instances"><p id="control.i:Key" class="caption collapser" onclick="toggleSection('i:Key')">Instances</p><div id="section.i:Key" class="show"><table><tr><td class="src"><a href="/Library/Frameworks/GHC.framework/Versions/7.4.2-i386/usr/share/doc/ghc/html/libraries/base-4.5.1.0/Data-Eq.html#t:Eq">Eq</a> <a href="Web-ClientSession.html#t:Key">Key</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="/Library/Frameworks/GHC.framework/Versions/7.4.2-i386/usr/share/doc/ghc/html/libraries/base-4.5.1.0/Text-Show.html#t:Show">Show</a> <a href="Web-ClientSession.html#t:Key">Key</a></td><td class="doc"><p>Dummy <code><a href="/Library/Frameworks/GHC.framework/Versions/7.4.2-i386/usr/share/doc/ghc/html/libraries/base-4.5.1.0/Text-Show.html#t:Show">Show</a></code> instance.
</p></td></tr><tr><td class="src"><a href="/Users/mizu_tama/workspace/yesodprojects/myfirstyesod/cabal-dev//doc/html/Data-Serialize.html#t:Serialize">Serialize</a> <a href="Web-ClientSession.html#t:Key">Key</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a name="t:IV" class="def">IV</a> = <a href="/Users/mizu_tama/workspace/yesodprojects/myfirstyesod/cabal-dev//doc/html/Crypto-Modes.html#t:IV">IV</a> <a href="/Users/mizu_tama/workspace/yesodprojects/myfirstyesod/cabal-dev//doc/html/Crypto-Cipher-AES-Haskell.html#t:AES256">AES256</a></p><div class="doc"><p>The initialization vector used by AES.  Should be exactly 16
 bytes long.
</p></div></div><div class="top"><p class="src"><a name="v:randomIV" class="def">randomIV</a> :: <a href="/Library/Frameworks/GHC.framework/Versions/7.4.2-i386/usr/share/doc/ghc/html/libraries/base-4.5.1.0/System-IO.html#t:IO">IO</a> <a href="Web-ClientSession.html#t:IV">IV</a></p><div class="doc"><p>Randomly construct a fresh initialization vector.  You
 <em>should not</em> reuse initialization vectors.
</p></div></div><div class="top"><p class="src"><a name="v:mkIV" class="def">mkIV</a> :: <a href="/Library/Frameworks/GHC.framework/Versions/7.4.2-i386/usr/share/doc/ghc/html/libraries/bytestring-0.9.2.1/Data-ByteString.html#t:ByteString">ByteString</a> -&gt; <a href="/Library/Frameworks/GHC.framework/Versions/7.4.2-i386/usr/share/doc/ghc/html/libraries/base-4.5.1.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="Web-ClientSession.html#t:IV">IV</a></p><div class="doc"><p>Construct an initialization vector from a <code><a href="/Library/Frameworks/GHC.framework/Versions/7.4.2-i386/usr/share/doc/ghc/html/libraries/bytestring-0.9.2.1/Data-ByteString.html#t:ByteString">ByteString</a></code>.
 Fails if there isn't exactly 16 bytes.
</p></div></div><div class="top"><p class="src"><a name="v:getKey" class="def">getKey</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="/Library/Frameworks/GHC.framework/Versions/7.4.2-i386/usr/share/doc/ghc/html/libraries/base-4.5.1.0/System-IO.html#t:FilePath">FilePath</a></td><td class="doc"><p>File name where key is stored.
</p></td></tr><tr><td class="src">-&gt; <a href="/Library/Frameworks/GHC.framework/Versions/7.4.2-i386/usr/share/doc/ghc/html/libraries/base-4.5.1.0/System-IO.html#t:IO">IO</a> <a href="Web-ClientSession.html#t:Key">Key</a></td><td class="doc"><p>The actual key.
</p></td></tr></table></div><div class="doc"><p>Get a key from the given text file.
</p><p>If the file does not exist or is corrupted a random key will
 be generated and stored in that file.
</p></div></div><div class="top"><p class="src"><a name="v:defaultKeyFile" class="def">defaultKeyFile</a> :: <a href="/Library/Frameworks/GHC.framework/Versions/7.4.2-i386/usr/share/doc/ghc/html/libraries/base-4.5.1.0/System-IO.html#t:FilePath">FilePath</a></p><div class="doc"><p>The default key file.
</p></div></div><div class="top"><p class="src"><a name="v:getDefaultKey" class="def">getDefaultKey</a> :: <a href="/Library/Frameworks/GHC.framework/Versions/7.4.2-i386/usr/share/doc/ghc/html/libraries/base-4.5.1.0/System-IO.html#t:IO">IO</a> <a href="Web-ClientSession.html#t:Key">Key</a></p><div class="doc"><p>Simply calls <code><a href="Web-ClientSession.html#v:getKey">getKey</a></code> <code><a href="Web-ClientSession.html#v:defaultKeyFile">defaultKeyFile</a></code>.
</p></div></div><div class="top"><p class="src"><a name="v:initKey" class="def">initKey</a> :: <a href="/Library/Frameworks/GHC.framework/Versions/7.4.2-i386/usr/share/doc/ghc/html/libraries/bytestring-0.9.2.1/Data-ByteString.html#t:ByteString">ByteString</a> -&gt; <a href="/Library/Frameworks/GHC.framework/Versions/7.4.2-i386/usr/share/doc/ghc/html/libraries/base-4.5.1.0/Data-Either.html#t:Either">Either</a> <a href="/Library/Frameworks/GHC.framework/Versions/7.4.2-i386/usr/share/doc/ghc/html/libraries/base-4.5.1.0/Data-String.html#t:String">String</a> <a href="Web-ClientSession.html#t:Key">Key</a></p><div class="doc"><p>Initializes a <code><a href="Web-ClientSession.html#t:Key">Key</a></code> from a random <code><a href="/Library/Frameworks/GHC.framework/Versions/7.4.2-i386/usr/share/doc/ghc/html/libraries/bytestring-0.9.2.1/Data-ByteString.html#t:ByteString">ByteString</a></code>.  Fails if
 there isn't exactly 96 bytes (256 bits for AES and 512 bits
 for Skein-MAC-512-512).
</p></div></div><div class="top"><p class="src"><a name="v:randomKey" class="def">randomKey</a> :: <a href="/Library/Frameworks/GHC.framework/Versions/7.4.2-i386/usr/share/doc/ghc/html/libraries/base-4.5.1.0/System-IO.html#t:IO">IO</a> (<a href="/Library/Frameworks/GHC.framework/Versions/7.4.2-i386/usr/share/doc/ghc/html/libraries/bytestring-0.9.2.1/Data-ByteString.html#t:ByteString">ByteString</a>, <a href="Web-ClientSession.html#t:Key">Key</a>)</p><div class="doc"><p>Generate a random <code><a href="Web-ClientSession.html#t:Key">Key</a></code>.  Besides the <code><a href="Web-ClientSession.html#t:Key">Key</a></code>, the
 <code>ByteString</code> passed to <code><a href="Web-ClientSession.html#v:initKey">initKey</a></code> is returned so that it can be
 saved for later use.
</p></div></div><h1 id="g:2">Actual encryption/decryption
</h1><div class="top"><p class="src"><a name="v:encrypt" class="def">encrypt</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="Web-ClientSession.html#t:Key">Key</a></td><td class="doc"><p>Key of the server.
</p></td></tr><tr><td class="src">-&gt; <a href="Web-ClientSession.html#t:IV">IV</a></td><td class="doc"><p>New, random initialization vector (see <code><a href="Web-ClientSession.html#v:randomIV">randomIV</a></code>).
</p></td></tr><tr><td class="src">-&gt; <a href="/Library/Frameworks/GHC.framework/Versions/7.4.2-i386/usr/share/doc/ghc/html/libraries/bytestring-0.9.2.1/Data-ByteString.html#t:ByteString">ByteString</a></td><td class="doc"><p>Serialized cookie data.
</p></td></tr><tr><td class="src">-&gt; <a href="/Library/Frameworks/GHC.framework/Versions/7.4.2-i386/usr/share/doc/ghc/html/libraries/bytestring-0.9.2.1/Data-ByteString.html#t:ByteString">ByteString</a></td><td class="doc"><p>Encoded cookie data to be given to
 the client browser.
</p></td></tr></table></div><div class="doc"><p>Encrypt (AES-CTR), authenticate (Skein-MAC-512-256) and
 encode (Base64) the given cookie data.  The returned byte
 string is ready to be used in a response header.
</p></div></div><div class="top"><p class="src"><a name="v:encryptIO" class="def">encryptIO</a> :: <a href="Web-ClientSession.html#t:Key">Key</a> -&gt; <a href="/Library/Frameworks/GHC.framework/Versions/7.4.2-i386/usr/share/doc/ghc/html/libraries/bytestring-0.9.2.1/Data-ByteString.html#t:ByteString">ByteString</a> -&gt; <a href="/Library/Frameworks/GHC.framework/Versions/7.4.2-i386/usr/share/doc/ghc/html/libraries/base-4.5.1.0/System-IO.html#t:IO">IO</a> <a href="/Library/Frameworks/GHC.framework/Versions/7.4.2-i386/usr/share/doc/ghc/html/libraries/bytestring-0.9.2.1/Data-ByteString.html#t:ByteString">ByteString</a></p><div class="doc"><p>Same as <code><a href="Web-ClientSession.html#v:encrypt">encrypt</a></code>, however randomly generates the
 initialization vector for you.
</p></div></div><div class="top"><p class="src"><a name="v:decrypt" class="def">decrypt</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="Web-ClientSession.html#t:Key">Key</a></td><td class="doc"><p>Key of the server.
</p></td></tr><tr><td class="src">-&gt; <a href="/Library/Frameworks/GHC.framework/Versions/7.4.2-i386/usr/share/doc/ghc/html/libraries/bytestring-0.9.2.1/Data-ByteString.html#t:ByteString">ByteString</a></td><td class="doc"><p>Encoded cookie data given by the browser.
</p></td></tr><tr><td class="src">-&gt; <a href="/Library/Frameworks/GHC.framework/Versions/7.4.2-i386/usr/share/doc/ghc/html/libraries/base-4.5.1.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="/Library/Frameworks/GHC.framework/Versions/7.4.2-i386/usr/share/doc/ghc/html/libraries/bytestring-0.9.2.1/Data-ByteString.html#t:ByteString">ByteString</a></td><td class="doc"><p>Serialized cookie data.
</p></td></tr></table></div><div class="doc"><p>Decode (Base64), verify the integrity and authenticity
 (Skein-MAC-512-256) and decrypt (AES-CTR) the given encoded
 cookie data.  Returns the original serialized cookie data.
 Fails if the data is corrupted.
</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.11.0</p></div></body></html>